Remit = {
    url : 'main.php',
	n1 : 0,
	n2 : 0,
    count_deleted : function() {
      var n = $("input[name='deleted']:visible:checked").length;
	  $('#div1_checked').text(n>0?(n+" checked!") : 'delete');
	  /* if(n>0) {
		if(Remit.n2==0) {
		  	// $("img[title^=remove]").wrap('<a href="javascript:void(0);">');
			$('#img_delete').wrap('<a href="javascript:void(0);"></a>');
			Remit.n2 ++;
	  	}
	  }
	  else {
		  //if($("img[title^=remove]").parent().is('a')) { //$('#').attr(tagName).toLowerCase()
		  if($('#img_delete').parent().is('a')) {
			$("#img_delete").unwrap();
			Remit.n2 = 0;
		  } 
	  } */
	  return true;
    },
	count_download : function() {
      var n = $("input[name=download]:checked").length;
	  $('#div_checked').text(n>0?(n+" checked") : 'download');
	  /* if(n>0) {
  		//  alert($("#img_download").parent().get(0).tagName+','+Remit.n1);
		if(Remit.n1==0) {
			$("#img_download").wrap('<a href="https://mycibp.ca/pams/get_rfiles.php" target="i_view"></a>');
			Remit.n1 ++;
		}
	  }
	  else {
  		  //alert($("#img_download").parent().get(0).tagName);
		  if($("#img_download").parent().is('a')) {
		  $("#img_download").unwrap();
			Remit.n1 = 0;
		  } 
	  } */
	  return true;
    },
	update_deleted : function() {
		$('#img_delete').parent().click(function() {
		  if($("input[name='deleted']:visible:checked").length==0) return false;
		  var files = $('input[name="deleted"]:visible:checked').map(function() {return $(this).val();}).get().join(';');
		  if(confirm('Are you sure to delete the files:['+files+']?')) {
			// William added on Mar18 for delete button display normally.
			//Remit.n2 = 0;
			//$('#div1_checked').text('delete');
			//$("#img_delete").unwrap();
			//delete=1&files=payment_bc200_20110201044421.csv%2Cpayment_bc300_20110128055927.csv
			$.ajax({
				type: "POST",
				url: Remit.url,
				data: {'delete':1,'files':files},
				success: function(data) {
					// alert('['+data+'],'+data.length); // bugs: why 3, 4 instead of 1???
					if(data.length>0 && /Y/.test(data)) {
						$("input[name='deleted']:checked").each(function() {
							$(this).parents('tr:eq(0)').hide();
						});
						$('#div1_checked').text('delete');
						if( $('#checkall1').is(':checked')) { 
						  $('#checkall1').attr('checked', false);
						  //$('#checkall1').removeAttr('checked');
						}
					}
					return false;
				}
			});
			return false;
		  }
		});
	},
	update_download_all : function() {
		$('#img_download').parent().click(function() {
		  if($("input[name='download']:visible:checked").length==0) return false;												   
		  var files = $('input[name="download"]:checked').map(function() {return $(this).val();}).get().join(';');			
		  if(confirm('Are you sure to download the files:['+files+']?')) {		  
			/* Remit.n1 = 0; // reset global variable.
			$('#div_checked').text('download');*/
			$.ajax({
				type: "POST",
				url: Remit.url,
				async:false,
				data: {'download':1,'files': files},
				success: function(data) { //document.getElementById(sid).innerHTML = data; //return false; //}
					var t = data.split(';');
					$('.count_time').each(function(index) {
						document.getElementById(this.id).innerHTML = t.shift();
					});
					$('#div_checked').text('download');
					/*if( $('#checkall2').is(':checked')) { 
					  $('#checkall2').attr('checked', false);
					  $('#checkall2').removeAttr('checked');
					}*/
				}
			});
			document.location.href='https://mycibp.ca/pams/get_rfiles.php';
			return true;
		  }
		});
	},
	reply_1 : function(division) {
		$.post(Remit.url, $('#f_'+division).serialize(), function(data) {
			$('#f_'+division).parent().parent().find('td:last label').text(data);
		});
		return false;
	},
	reply : function(rid) {
		var form = $('#f_'+rid);
		$.ajax({
			type: form.attr('method'),
			url: Remit.url,
			data: form.serialize(), 
			success: function(data) {
				$('#f_'+rid).parent().parent().find('td:last label').text(data);
			}
		});
		return false;
	},
	update_download_time : function(file, sid) {
		$.ajax({
				type: "POST",
				url: Remit.url,
				data: {'dfile': file},
				success: function(data) {
						document.getElementById(sid).innerHTML = data;
						return false;
				}
		});
		return false;
	}
};
$(document).ready(function() {
	var TabbedPanels1 = new Spry.Widget.TabbedPanels("TabbedPanels1");
	$('#tab8').bind('click', function(event) {
		 event.preventDefault();
		if(/Hide/.test(this.innerHTML)){
			parent.document.getElementsByTagName('FRAMESET').item(1).cols = '1,*';
			this.innerHTML='&nbsp;&nbsp;&nbsp;Show Left Menu';
			$(this).removeClass('move2').addClass('move1');
		} else {
			parent.document.getElementsByTagName('FRAMESET').item(1).cols = '200,*';
			this.innerHTML='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hide Left Menu';
			$(this).removeClass('move1').addClass('move2');
		}
	});
	$('#legend1').bind('click', function() {
		$('#title1').fadeIn(100);
		$('#search1').fadeOut(200);
	});
	$('#title1').bind('click', function() {
		$('#title1').fadeOut(200);
		$('#search1').fadeIn(200);
	});	
	$(window).resize(function(){
		var browserWidth = $(window).width();
		if(parseInt(browserWidth) <= 740){
			$('fieldset').addClass('fsWidth_fix');
		} else {
			$('fieldset').removeAttr('class');
		};
	});
});
